"""
üßÆ RSA CALCULATOR - Helper –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –æ–±—á–∏—Å–ª–µ–Ω—å

–¶–µ–π —Å–∫—Ä–∏–ø—Ç –¥–æ–ø–æ–º–∞–≥–∞—î —Å—Ç—É–¥–µ–Ω—Ç–∞–º –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–≤–æ—ó –æ–±—á–∏—Å–ª–µ–Ω–Ω—è
–ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ RSA worksheet
"""

import math

def gcd(a, b):
    """–ù–∞–π–±—ñ–ª—å—à–∏–π —Å–ø—ñ–ª—å–Ω–∏–π –¥—ñ–ª—å–Ω–∏–∫"""
    while b:
        a, b = b, a % b
    return a

def extended_gcd(a, b):
    """–†–æ–∑—à–∏—Ä–µ–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –ï–≤–∫–ª—ñ–¥–∞"""
    if a == 0:
        return b, 0, 1
    gcd_val, x1, y1 = extended_gcd(b % a, a)
    x = y1 - (b // a) * x1
    y = x1
    return gcd_val, x, y

def mod_inverse(e, phi):
    """–ú–æ–¥—É–ª—å–Ω–∏–π –æ–±–µ—Ä–Ω–µ–Ω–∏–π"""
    gcd_val, x, y = extended_gcd(e, phi)
    if gcd_val != 1:
        return None
    return x % phi

def is_prime(n):
    """–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —á–∏—Å–ª–æ –ø—Ä–æ—Å—Ç–µ"""
    if n < 2:
        return False
    for i in range(2, int(n ** 0.5) + 1):
        if n % i == 0:
            return False
    return True

def factorize(n):
    """–°–ø—Ä–æ–±–∞ —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó (–¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö n)"""
    import time
    start = time.time()

    for i in range(2, int(n**0.5) + 1):
        if n % i == 0:
            elapsed = time.time() - start
            return i, n // i, elapsed * 1000

    return None, None, None

print("="*70)
print("üßÆ RSA CALCULATOR")
print("="*70)

while True:
    print("\nüìã –û–±–µ—Ä—ñ—Ç—å –æ–ø–µ—Ä–∞—Ü—ñ—é:")
    print("1. –û–±—á–∏—Å–ª–∏—Ç–∏ n = p √ó q")
    print("2. –û–±—á–∏—Å–ª–∏—Ç–∏ œÜ(n) = (p-1) √ó (q-1)")
    print("3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ gcd(e, œÜ(n))")
    print("4. –ó–Ω–∞–π—Ç–∏ d (–º–æ–¥—É–ª—å–Ω–∏–π –æ–±–µ—Ä–Ω–µ–Ω–∏–π)")
    print("5. –ó–∞—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è")
    print("6. –†–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è")
    print("7. –ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç ‚Üí —á–∏—Å–ª–∞ (ASCII)")
    print("8. –ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ —á–∏—Å–ª–∞ ‚Üí —Ç–µ–∫—Å—Ç")
    print("9. –§–∞–∫—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏ n (–∞—Ç–∞–∫–∞)")
    print("10. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —á–∏—Å–ª–æ –ø—Ä–æ—Å—Ç–µ")
    print("0. –í–∏–π—Ç–∏")

    choice = input("\n–í–∞—à –≤–∏–±—ñ—Ä: ").strip()

    if choice == '0':
        print("\nüëã –î–æ –ø–æ–±–∞—á–µ–Ω–Ω—è!")
        break

    elif choice == '1':
        print("\n‚ûï –û–±—á–∏—Å–ª–∏—Ç–∏ n = p √ó q")
        p = int(input("–í–≤–µ–¥—ñ—Ç—å p: "))
        q = int(input("–í–≤–µ–¥—ñ—Ç—å q: "))
        n = p * q
        print(f"\n‚úÖ n = {p} √ó {q} = {n}")

    elif choice == '2':
        print("\nüìê –û–±—á–∏—Å–ª–∏—Ç–∏ œÜ(n) = (p-1) √ó (q-1)")
        p = int(input("–í–≤–µ–¥—ñ—Ç—å p: "))
        q = int(input("–í–≤–µ–¥—ñ—Ç—å q: "))
        phi = (p - 1) * (q - 1)
        print(f"\n‚úÖ œÜ(n) = ({p}-1) √ó ({q}-1)")
        print(f"‚úÖ œÜ(n) = {p-1} √ó {q-1} = {phi}")

    elif choice == '3':
        print("\nüîç –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ gcd(e, œÜ(n))")
        e = int(input("–í–≤–µ–¥—ñ—Ç—å e: "))
        phi = int(input("–í–≤–µ–¥—ñ—Ç—å œÜ(n): "))
        g = gcd(e, phi)
        print(f"\n‚úÖ gcd({e}, {phi}) = {g}")
        if g == 1:
            print("‚úÖ e —Ç–∞ œÜ(n) –≤–∑–∞—î–º–Ω–æ –ø—Ä–æ—Å—Ç—ñ! –ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏.")
        else:
            print("‚ùå e —Ç–∞ œÜ(n) –ù–ï –≤–∑–∞—î–º–Ω–æ –ø—Ä–æ—Å—Ç—ñ! –í–∏–±–µ—Ä—ñ—Ç—å —ñ–Ω—à–µ e.")

    elif choice == '4':
        print("\nüîë –ó–Ω–∞–π—Ç–∏ d (–º–æ–¥—É–ª—å–Ω–∏–π –æ–±–µ—Ä–Ω–µ–Ω–∏–π)")
        e = int(input("–í–≤–µ–¥—ñ—Ç—å e: "))
        phi = int(input("–í–≤–µ–¥—ñ—Ç—å œÜ(n): "))

        d = mod_inverse(e, phi)
        if d is None:
            print(f"\n‚ùå –ú–æ–¥—É–ª—å–Ω–∏–π –æ–±–µ—Ä–Ω–µ–Ω–∏–π –Ω–µ —ñ—Å–Ω—É—î!")
            print(f"   gcd(e, œÜ(n)) –º–∞—î –±—É—Ç–∏ 1")
        else:
            print(f"\n‚úÖ d = {d}")
            print(f"\n–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: (e √ó d) mod œÜ(n) = {(e * d) % phi}")
            if (e * d) % phi == 1:
                print("‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞!")
            else:
                print("‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è—Ö!")

    elif choice == '5':
        print("\nüîí –ó–∞—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è")
        message = int(input("–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (—á–∏—Å–ª–æ): "))
        e = int(input("–í–≤–µ–¥—ñ—Ç—å e (–ø—É–±–ª—ñ—á–Ω–∞ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞): "))
        n = int(input("–í–≤–µ–¥—ñ—Ç—å n (–º–æ–¥—É–ª—å): "))

        if message >= n:
            print(f"\n‚ùå –ü–û–ú–ò–õ–ö–ê: –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ({message}) –º–∞—î –±—É—Ç–∏ –º–µ–Ω—à–µ n ({n})")
        else:
            ciphertext = pow(message, e, n)
            print(f"\n‚úÖ –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:")
            print(f"   C = M^e mod n")
            print(f"   C = {message}^{e} mod {n}")
            print(f"   C = {ciphertext}")

    elif choice == '6':
        print("\nüîì –†–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è")
        ciphertext = int(input("–í–≤–µ–¥—ñ—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: "))
        d = int(input("–í–≤–µ–¥—ñ—Ç—å d (–ø—Ä–∏–≤–∞—Ç–Ω–∞ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞): "))
        n = int(input("–í–≤–µ–¥—ñ—Ç—å n (–º–æ–¥—É–ª—å): "))

        message = pow(ciphertext, d, n)
        print(f"\n‚úÖ –†–æ–∑—à–∏—Ñ—Ä–æ–≤–∞–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:")
        print(f"   M = C^d mod n")
        print(f"   M = {ciphertext}^{d} mod {n}")
        print(f"   M = {message}")

    elif choice == '7':
        print("\nüî¢ –ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç ‚Üí —á–∏—Å–ª–∞ (ASCII)")
        text = input("–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç: ")
        print(f"\n‚úÖ ASCII –∫–æ–¥–∏:")
        for char in text:
            print(f"   '{char}' ‚Üí {ord(char)}")

    elif choice == '8':
        print("\nüî§ –ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ —á–∏—Å–ª–∞ ‚Üí —Ç–µ–∫—Å—Ç")
        numbers = input("–í–≤–µ–¥—ñ—Ç—å —á–∏—Å–ª–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–±—ñ–ª: ")
        codes = [int(x) for x in numbers.split()]
        text = ''.join([chr(code) for code in codes])
        print(f"\n‚úÖ –¢–µ–∫—Å—Ç: '{text}'")
        print(f"\n–ü–æ–∫—Ä–æ–∫–æ–≤–æ:")
        for code in codes:
            print(f"   {code} ‚Üí '{chr(code)}'")

    elif choice == '9':
        print("\nüîç –§–∞–∫—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏ n (–∞—Ç–∞–∫–∞)")
        n = int(input("–í–≤–µ–¥—ñ—Ç—å n: "))

        print(f"\n‚è≥ –ü–æ—à—É–∫ –¥—ñ–ª—å–Ω–∏–∫—ñ–≤...")
        p, q, time_ms = factorize(n)

        if p and q:
            print(f"\n‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ!")
            print(f"   n = {n}")
            print(f"   p = {p}")
            print(f"   q = {q}")
            print(f"   –ß–∞—Å: {time_ms:.2f} –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥")

            # –ü–æ–∫–∞–∑–∞—Ç–∏ —è–∫ —Ç–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –∑–ª–∞–º–∞—Ç–∏ RSA
            phi = (p - 1) * (q - 1)
            print(f"\n‚ö†Ô∏è  –ù–ê–°–õ–Ü–î–ö–ò:")
            print(f"   –¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –æ–±—á–∏—Å–ª–∏—Ç–∏ œÜ(n) = {phi}")
            print(f"   –ú–∞—é—á–∏ œÜ(n) —Ç–∞ e, –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ d")
            print(f"   –ú–∞—é—á–∏ d, –º–æ–∂–Ω–∞ —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –í–°–Ü –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è!")
        else:
            print(f"\n‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è —Ñ–∞–∫—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏ (–º–æ–∂–ª–∏–≤–æ –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–µ)")

    elif choice == '10':
        print("\nüîç –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —á–∏—Å–ª–æ –ø—Ä–æ—Å—Ç–µ")
        n = int(input("–í–≤–µ–¥—ñ—Ç—å —á–∏—Å–ª–æ: "))
        if is_prime(n):
            print(f"\n‚úÖ {n} —î –ü–†–û–°–¢–ò–ú —á–∏—Å–ª–æ–º")
        else:
            print(f"\n‚ùå {n} –ù–ï —î –ø—Ä–æ—Å—Ç–∏–º —á–∏—Å–ª–æ–º")

    else:
        print("\n‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π –≤–∏–±—ñ—Ä!")

    input("\n‚èé –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å Enter –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è...")
    print("\n" + "="*70)